clear
clang++-3.5 -O0 -g0 -c -emit-llvm $1 -o build/cur.bc
echo "clang++ .cpp to .bc complete"
llvm-dis build/cur.bc -o build/cur.ll
clang++-3.5 -pthreads build/cur.ll -o build/$2
#scp build/$2 sumi.cs.sfu.ca:~/$2
echo "llvm-dis .bc to .ll complete"

#opt -mem2reg -S build/cur.ll -o build/cur.ll
#opt -simplifycfg -S build/cur.ll -o build/cur.ll
opt -S build/cur.ll -o build/cur.ll
echo "llvm optimizations complete"
~/Eve/build/Debug+Asserts/bin/instrGraph build/cur.ll > build/cur.gv
#~/CMPT886/instrGraph/build/Debug+Asserts/bin/instrGraph build/cur.bc > build/cur.gv
echo "Instruction Graph dot-file complete"
sed 's/0x/x/g' build/cur.gv > build/temp.gv
mv build/temp.gv build/cur.gv
dot -Tpdf build/cur.gv -o $2.pdf
echo "Post script graph created"
#scp $2 24.87.92.19:/home/tdwyer/Eve/test/$2.pdf
head build/cur.gv
